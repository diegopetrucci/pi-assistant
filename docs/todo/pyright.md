---
title: Pyright TODO
date: 2024-11-27
summary: Checklist of current Pyright errors and warnings to unblock the CI job.
---

- [x] `src/pi_assistant/__init__.py:4` — import `audio` so `__all__` only lists defined names.
- [x] `src/pi_assistant/__init__.py:5` — import `cli` so `__all__` only lists defined names.
- [x] `src/pi_assistant/__init__.py:6` — import `config` so `__all__` only lists defined names.
- [x] `src/pi_assistant/__init__.py:7` — import `diagnostics` so `__all__` only lists defined names.
- [ ] `src/pi_assistant/assistant/llm.py:274` — ensure `response_format` is a valid literal (`mp3`, `opus`, `aac`, `flac`, `wav`, `pcm`) when calling `client.responses.create`.
- [x] `src/pi_assistant/assistant/transcript.py:108` — `_maybe_finalize` now returns `tuple[bool, str | None]`, ensuring callers only see `str | None`.
- [ ] `src/pi_assistant/audio/capture.py:60` — guard `loop` before `call_soon_threadsafe`.
- [ ] `src/pi_assistant/audio/capture.py:187` — stop calling `.get()` on the string `device_filter`.
- [ ] `src/pi_assistant/audio/capture.py:201` — device listing code should use structured types instead of calling `.get()` on the `DeviceList`.
- [ ] `src/pi_assistant/audio/capture.py:202` — same as above for the `output` device lookup.
- [ ] `src/pi_assistant/audio/playback.py:117` — ensure `int(sample_rate)` only receives real numbers.
- [ ] `src/pi_assistant/audio/playback.py:131` — `SpeechPlayer._device_snapshot` must always return a plain dict.
- [ ] `src/pi_assistant/audio/playback.py:133` — convert `DeviceList` into a dictionary before storing.
- [ ] `src/pi_assistant/audio/playback.py:227` — `main_loop` timeout must be numeric.
- [ ] `src/pi_assistant/audio/playback.py:228` — same as above for the next `int()` call.
- [ ] `src/pi_assistant/cli/controller.py:88` — `ws_client.websocket` may be `None`; guard before using.
- [ ] `src/pi_assistant/cli/controller.py:171` — ensure `message` is always `dict` before broadcasting.
- [ ] `src/pi_assistant/cli/controller.py:194` — same type guard for the per-connection message.
- [ ] `src/pi_assistant/cli/controller.py:215` — avoid subscripting an optional queue result.
- [ ] `src/pi_assistant/cli/controller.py:227` — guard `controller_state["wakeword"]` before subscripting.
- [ ] `src/pi_assistant/cli/controller.py:352` — `wakeword` can be `None`; check before `.next()` access.
- [ ] `src/pi_assistant/cli/controller.py:353` — same as above for `.detected`.
- [ ] `src/pi_assistant/cli/controller.py:357` — same as above for `.wakeword`.
- [ ] `src/pi_assistant/cli/controller.py:358` — same as above for `.confidence`.
- [ ] `src/pi_assistant/cli/controller.py:360` — ensure `entry["wakeword"]` exists before indexing.
- [ ] `src/pi_assistant/cli/controller.py:364` — same check for the `wakeword` entry.
- [ ] `src/pi_assistant/cli/controller.py:399` — same check for `wakeword`.
- [ ] `src/pi_assistant/cli/controller.py:403` — same check for `wakeword`.
- [ ] `src/pi_assistant/cli/controller.py:427` — same check for `wakeword`.
- [ ] `src/pi_assistant/cli/controller.py:431` — same check for `wakeword`.
- [ ] `src/pi_assistant/cli/controller.py:467` — ensure `message` is not `None` before indexing.
- [ ] `src/pi_assistant/cli/controller.py:471` — same guard for the `wakeword` entry.
- [ ] `src/pi_assistant/cli/controller.py:475` — same guard for the `wakeword`.
- [ ] `src/pi_assistant/cli/prompts.py:68` — the `PromptTemplate` spec must match the dict keys.
- [ ] `src/pi_assistant/cli/prompts.py:77` — same as above for the `reminder` template.
- [ ] `src/pi_assistant/cli/prompts.py:86` — same as above for the `system` template.
- [ ] `src/pi_assistant/cli/prompts.py:95` — same as above for the `prompt` template.
- [ ] `src/pi_assistant/cli/prompts.py:104` — same as above for the `context` template.
- [ ] `src/pi_assistant/cli/prompts.py:113` — same as above for the `examples` template.
- [ ] `src/pi_assistant/cli/prompts.py:122` — same as above for the `closing` template.
- [ ] `src/pi_assistant/cli/prompts.py:131` — same as above for the `fallback` template.
- [ ] `src/pi_assistant/network/websocket_client.py:81` — guard optional return from `websocket`.
- [ ] `src/pi_assistant/network/websocket_client.py:90` — same guard for the `connected` flag.
- [ ] `src/pi_assistant/network/websocket_client.py:95` — same guard for `closed`.
- [ ] `src/pi_assistant/network/websocket_client.py:108` — same guard for `connected`.
- [ ] `src/pi_assistant/network/websocket_client.py:109` — same guard for `closed`.
- [ ] `src/pi_assistant/network/websocket_client.py:131` — avoid subscripting an optional object.
- [ ] `src/pi_assistant/network/websocket_client.py:134` — same as above for `closed`.
- [ ] `src/pi_assistant/network/websocket_client.py:151` — guard `event` before `["error"]`.
- [ ] `src/pi_assistant/network/websocket_client.py:152` — same as above for `["kwargs"]`.
- [ ] `src/pi_assistant/network/websocket_client.py:153` — same as above for `["exc"]`.
- [ ] `src/pi_assistant/network/websocket_client.py:154` — same guard for `["kwargs"]`.
- [ ] `src/pi_assistant/network/websocket_client.py:155` — same guard for `["error"]`.
- [ ] `tests/test_cli_app.py:214-243` — use proper fake objects with typed attributes instead of plain `object`.
- [ ] `tests/test_cli_controller_run.py:66` — dedupe the `fake_log` helper.
- [ ] `tests/test_cli_controller_run.py:89-205` — replace generic fakes with typed test doubles.
- [ ] `tests/test_cli_controller_run.py:309-342` — same as above for the third test block.
- [ ] `tests/test_network_websocket_client.py:170-194` — `DummyWebSocket` should satisfy `ClientConnection`.
- [ ] `tests/test_network_websocket_client.py:184` — protect against subscripting `None`.
- [ ] `tests/test_wake_word.py:37` — pass `Path` objects instead of raw strings to `WakeWord`.
- [ ] `tests/test_wake_word.py:38` — same as above for `fallback_model_path`.
